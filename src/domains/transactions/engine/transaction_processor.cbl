000001 IDENTIFICATION DIVISION.
000002 PROGRAM-ID. TRANSACTION-PROCESSOR.
000003 AUTHOR. Gemini.
000004
000005 ENVIRONMENT DIVISION.
000006 INPUT-OUTPUT SECTION.
000007 FILE-CONTROL.
000008     SELECT TRANSACTION-IN ASSIGN TO KEYBOARD
000009         ORGANIZATION IS SEQUENTIAL
000010         ACCESS MODE IS SEQUENTIAL
000011         FILE STATUS IS FS-TRANSACTION-IN.
000012     SELECT REPORT-OUT ASSIGN TO DISPLAY
000013         ORGANIZATION IS LINE SEQUENTIAL
000014         ACCESS MODE IS SEQUENTIAL
000015         FILE STATUS IS FS-REPORT-OUT.
000016
000017 DATA DIVISION.
000018 FILE SECTION.
000019 FD  TRANSACTION-IN
000020     RECORD CONTAINS 59 CHARACTERS
000021     DATA RECORD IS TRANSACTION-RECORD.
000022 01  TRANSACTION-RECORD.
000023     COPY "transaction_record.cpy".
000024
000025 FD  REPORT-OUT.
000026 01  REPORT-RECORD.
000027     05 RP-TOTAL-TRANSACTIONS   PIC 9(08).
000028     05 FILLER                  PIC X(01) VALUE SPACE.
000029     05 RP-TOTAL-AMOUNT         PIC S9(13)V99.
000030
000031 WORKING-STORAGE SECTION.
000032 01  WS-WORK-AREAS.
000033     05 WS-EOF                  PIC X(1) VALUE 'N'.
000034     05 WS-COUNTER              PIC 9(8) VALUE 0.
000035     05 WS-TOTAL-AMOUNT         PIC S9(13)V99 VALUE 0.
000036     05 WS-EXIT-CODE            PIC 9(1) VALUE 0.
000037
000038 01  FILE-STATUS-CODES.
000039     05 FS-TRANSACTION-IN       PIC X(2).
000040     05 FS-REPORT-OUT           PIC X(2).
000041
000042 PROCEDURE DIVISION.
000043 MAIN-PROCEDURE.
000044
000045     OPEN INPUT TRANSACTION-IN
000046     IF FS-TRANSACTION-IN NOT = "00"
000047        DISPLAY "Fatal: Error opening input file. Status: " 
000048                FS-TRANSACTION-IN UPON SYSERR
000049        MOVE 1 TO WS-EXIT-CODE
000050        GO TO CLEANUP-AND-EXIT
000051     END-IF
000052
000053     OPEN OUTPUT REPORT-OUT
000054     IF FS-REPORT-OUT NOT = "00"
000055        DISPLAY "Fatal: Error opening output file. Status: " 
000056                FS-REPORT-OUT UPON SYSERR
000057        MOVE 1 TO WS-EXIT-CODE
000058        GO TO CLEANUP-AND-EXIT
000059     END-IF
000060
000061     PERFORM PROCESS-RECORDS UNTIL WS-EOF = 'Y'
000062
000063     MOVE WS-COUNTER TO RP-TOTAL-TRANSACTIONS
000064     MOVE WS-TOTAL-AMOUNT TO RP-TOTAL-AMOUNT
000065     WRITE REPORT-RECORD
000066     IF FS-REPORT-OUT NOT = "00"
000067         DISPLAY "Fatal: Error writing to output file. Status: "
000068                 FS-REPORT-OUT UPON SYSERR
000069         MOVE 1 TO WS-EXIT-CODE
000070     END-IF.
000071
000072 CLEANUP-AND-EXIT.
000073     CLOSE TRANSACTION-IN
000074     CLOSE REPORT-OUT
000075     STOP RUN WS-EXIT-CODE.
000076
000077 PROCESS-RECORDS.
000078     READ TRANSACTION-IN
000079         AT END
000080             MOVE 'Y' TO WS-EOF
000081         NOT AT END
000082             IF FS-TRANSACTION-IN = "00"
000083                 ADD 1 TO WS-COUNTER
000084                 ADD TR-AMOUNT TO WS-TOTAL-AMOUNT
000085             ELSE
000086                 DISPLAY "Warning: Error reading input record. "
000087                         "Status: " FS-TRANSACTION-IN UPON SYSERR
000088                 MOVE 'Y' TO WS-EOF
000089                 MOVE 1 TO WS-EXIT-CODE
000090             END-IF
000091     END-READ.
000092
000093 END PROGRAM TRANSACTION-PROCESSOR.